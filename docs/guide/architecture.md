# æ¶æ„è®¾è®¡

æœ¬æ–‡æ¡£ä»‹ç» Croupier C++ SDK çš„æ¶æ„è®¾è®¡ã€‚

## å››å±‚ç»„ä»¶åŒ–æ¶æ„

```
Component Level    â† economy-system (å¯åˆ†å‘æ¨¡å—)
     â†“
Resource Level     â† é’±åŒ…ç®¡ç†é¢æ¿ (UI èµ„æºç»„ç»‡)
     â†“
Entity Level       â† wallet.entity (ä¸šåŠ¡å¯¹è±¡æ¨¡å‹)
     â†“
Function Level     â† wallet.transfer (å…·ä½“å‡½æ•°å®ç°)
```

### Function Levelï¼ˆå‡½æ•°å±‚ï¼‰

æœ€åº•å±‚çš„æ‰§è¡Œå•å…ƒï¼Œå®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼š

```cpp
std::string TransferHandler(const std::string& context, const std::string& payload) {
    // å…·ä½“çš„è½¬è´¦é€»è¾‘
    return R"({"success": true})";
}
```

### Entity Levelï¼ˆå®ä½“å±‚ï¼‰

ä¸šåŠ¡å¯¹è±¡çš„æŠ½è±¡ï¼Œå®šä¹‰å¯¹è±¡çš„æ“ä½œï¼š

```cpp
VirtualObjectDescriptor wallet_entity;
wallet_entity.id = "wallet.entity";
wallet_entity.operations["transfer"] = "wallet.transfer";
wallet_entity.operations["get"] = "wallet.get";
```

### Resource Levelï¼ˆèµ„æºå±‚ï¼‰

UI å’Œèµ„æºçš„ç»„ç»‡å•ä½ï¼Œå®šä¹‰ç®¡ç†ç•Œé¢ï¼š

```cpp
ResourceDescriptor wallet_resource;
wallet_resource.id = "wallet.resource";
wallet_resource.entities = {"wallet.entity"};
wallet_resource.ui_path = "/ui/wallet/panel";
```

### Component Levelï¼ˆç»„ä»¶å±‚ï¼‰

å¯åˆ†å‘çš„æ¨¡å—ï¼ŒåŒ…å«å®Œæ•´çš„ä¸šåŠ¡åŠŸèƒ½ï¼š

```cpp
ComponentDescriptor economy_component;
economy_component.id = "economy-system";
economy_component.resources = {"wallet.resource", "currency.resource"};
economy_component.version = "0.1.0";
```

## ID å¼•ç”¨æ¨¡å¼

### è®¾è®¡ç†å¿µ

ä¼ ç»Ÿçš„å¯¹è±¡ä¼ é€’ä¼šæºå¸¦å®Œæ•´çŠ¶æ€ï¼Œå¯¼è‡´ç½‘ç»œå¼€é”€å¤§ä¸”çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚Croupier é‡‡ç”¨ **ID å¼•ç”¨æ¨¡å¼**ï¼š

```cpp
// ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸æ¨èï¼‰
Wallet wallet = GetWallet(player_id);  // åŒ…å«å®Œæ•´çŠ¶æ€
ProcessTransfer(wallet, to_player, amount);

// ID å¼•ç”¨æ–¹å¼ï¼ˆæ¨èï¼‰
std::string wallet_id = "wallet.entity:" + player_id;
ProcessTransferById(wallet_id, to_player, amount);
```

### ä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| ğŸš€ æè‡´æ€§èƒ½ | ç½‘ç»œä¼ è¾“åªæœ‰å‡ åå­—èŠ‚ |
| ğŸ›¡ï¸ çº¿ç¨‹å®‰å…¨ | æ— çŠ¶æ€å‡½æ•°ï¼Œå¤©ç„¶æ”¯æŒå¹¶å‘ |
| ğŸ”„ æ°´å¹³æ‰©å±• | å‡½æ•°å¯ä»¥éƒ¨ç½²åˆ°ä»»æ„èŠ‚ç‚¹ |
| ğŸ§© æ¾è€¦åˆ | å¯¹è±¡ç®¡ç†ä¸ä¸šåŠ¡é€»è¾‘å®Œå…¨åˆ†ç¦» |

## é€šä¿¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Game Server   â”‚
â”‚   (C++ SDK)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ gRPC
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Croupier Agent â”‚ (æœ¬åœ°/è¿œç¨‹)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ mTLS
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Croupier Serverâ”‚ (æ§åˆ¶é¢)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿æ¥æµç¨‹

1. **åˆå§‹åŒ–**: åˆ›å»º `CroupierClient`ï¼Œé…ç½®è¿æ¥å‚æ•°
2. **æ³¨å†Œ**: å‘ Agent æ³¨å†Œå‡½æ•°å’Œè™šæ‹Ÿå¯¹è±¡
3. **å¿ƒè·³**: å®šæœŸå‘é€å¿ƒè·³ä¿æŒè¿æ¥
4. **è°ƒç”¨**: æ¥æ”¶å¹¶å¤„ç†æ¥è‡ª Agent çš„å‡½æ•°è°ƒç”¨è¯·æ±‚
5. **é‡è¿**: è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨é‡è¿å¹¶é‡æ–°æ³¨å†Œ

## æ ¸å¿ƒç»„ä»¶

### CroupierClient

ä¸»å®¢æˆ·ç«¯ç±»ï¼Œè´Ÿè´£ï¼š
- è¿æ¥ç®¡ç†
- å‡½æ•°æ³¨å†Œ
- è™šæ‹Ÿå¯¹è±¡æ³¨å†Œ
- ç”Ÿå‘½å‘¨æœŸç®¡ç†

### GrpcService

gRPC é€šä¿¡å±‚ï¼Œè´Ÿè´£ï¼š
- Protobuf æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ–
- gRPC é€šé“ç®¡ç†
- å¼‚æ­¥è°ƒç”¨å¤„ç†

### ConfigManager

é…ç½®ç®¡ç†å™¨ï¼Œè´Ÿè´£ï¼š
- é…ç½®æ–‡ä»¶åŠ è½½
- ç¯å¢ƒå˜é‡è¦†ç›–
- é…ç½®éªŒè¯

## æ•°æ®æµ

### è¯·æ±‚æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web UI â”‚â”€â”€â”€â–¶â”‚  Server  â”‚â”€â”€â”€â–¶â”‚  Agent  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚C++ SDK   â”‚
                              â”‚Function  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å“åº”æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”
â”‚C++ SDK   â”‚â”€â”€â”€Responseâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚Agntâ”‚
â”‚Function  â”‚                    â””â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
                                  â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  Server  â”‚
                            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  Web UI â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## çº¿ç¨‹æ¨¡å‹

SDK é‡‡ç”¨å•çº¿ç¨‹äº‹ä»¶å¾ªç¯æ¨¡å‹ï¼š

- **ä¸»çº¿ç¨‹**: è¿è¡Œ `Serve()` æ–¹æ³•ï¼Œå¤„ç†æ‰€æœ‰ç½‘ç»œ I/O
- **å·¥ä½œçº¿ç¨‹**: å¯é€‰ï¼Œç”¨äºæ‰§è¡Œ CPU å¯†é›†å‹ä»»åŠ¡

```cpp
// å•çº¿ç¨‹æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
client.Serve();  // é˜»å¡åœ¨å½“å‰çº¿ç¨‹

// å¤šçº¿ç¨‹æ¨¡å¼
std::thread server_thread([&client]() {
    client.Serve();
});
// ... å…¶ä»–å·¥ä½œ
server_thread.join();
```

## é”™è¯¯å¤„ç†

### é”™è¯¯ä¼ æ’­

```
Function Handler
       â†“
   Error JSON
       â†“
gRPC Status
       â†“
Agent
       â†“
Server
       â†“
Web UI
```

### é”™è¯¯æ ¼å¼

```cpp
return R"({
    "success": false,
    "error": {
        "code": "INSUFFICIENT_BALANCE",
        "message": "ç©å®¶ä½™é¢ä¸è¶³"
    }
})";
```
