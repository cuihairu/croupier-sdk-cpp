name: Nightly Build

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 2 * * *'
  workflow_dispatch:

permissions:
  contents: write

env:
  BUILD_TYPE: Release
  SDK_VERSION_BASE: "0.1"
  VCPKG_BUILD_TYPE: release

jobs:
  version:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
      version_tag: ${{ steps.version.outputs.version_tag }}
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Generate Version
      id: version
      run: |
        DATE=$(date +%Y%m%d)
        TIME=$(date +%H%M)
        COMMIT_SHORT=$(git rev-parse --short HEAD)
        VERSION="${SDK_VERSION_BASE}.0-nightly.${DATE}.${COMMIT_SHORT}"
        VERSION_TAG="nightly-${DATE}-${COMMIT_SHORT}"

        echo "version=${VERSION}" >> $GITHUB_OUTPUT
        echo "version_tag=${VERSION_TAG}" >> $GITHUB_OUTPUT

        echo "Generated version: ${VERSION}"
        echo "Generated tag: ${VERSION_TAG}"

  build:
    needs: version
    strategy:
      fail-fast: false
      max-parallel: 2
      matrix:
        include:
          - os: windows-latest
            arch: x64
            vcpkg_triplet: x64-windows
            artifact_name: windows-x64

          - os: windows-latest
